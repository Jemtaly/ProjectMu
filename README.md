# ProjectMu

ProjectMu 是一个用于通过简谱生成 .wav 格式音频文件的工具。

ProjectMu is a tool for generating audio files in .wav format from numbered musical notations.

## 编译方法和依赖

要编译 ProjectMu 需要安装 antlr4：

```sh
pip install antlr4-tools
pip install antlr4-python3-runtime
```

完成后编译 `mu.g4`：

```sh
antlr4 -Dlanguage=Python3 -no-listener mu.g4
```

然后即可运行本目录下的 `mu.py`。

## 使用方法

```
usage: mu.py [-h] [-o OUTPUT] [-t TIMBRE] filename

ProjectMu - Numbered Notation Score Compiler

positional arguments:
  filename    path to the input numbered notation score file

options:
  -h, --help  show this help message and exit
  -o OUTPUT   output wav file path
  -t {sine,poly,triangle,sawtooth,square}
              timbre of the output sound
```

示例:

```
mu -o 'Bad Apple!!.wav' -t sine 'example/Bad Apple!!.nmn'
```

## 简谱格式说明

### 示例

+ Amazing Grace

```
G 3/4 88
0 0 <5,1> |
1 - [3]<321> | 3 - <32> | 1 - 6, |
5, - <5,1> | 1 - [3]<321> | 3 - <23> | 5 - - |
- - <35> | 5 - [3]<321> | 3 - <32> | 1 - 6, |
5, - <5,1> | 1 - [3]<321> | 3 - 2 | 1 - - | - - ||
```

+ Bad Apple!! - nomico

```
F# 4/4 137
6,, <<06,,5,,6,,>> 6,, <<06,,5,,6,,>> | 6,, <<06,,5,,6,,>> <6,,<6,,1,>> <2,<1,2,>> |
6,, <<06,,5,,6,,>> 6,, <<06,,5,,6,,>> | 6,, <<06,,5,,6,,>> <2,<1,2,>> <1,<6,,1,>> |,

<6,7,> <12> 3 <65> | 3 6, <32> <17,> | <6,7,> <12> 3 <21> | <7,6,> <7,1> <7,6,> <5#,7,> |
<6,7,> <12> 3 <65> | 3 6, <32> <17,> | <6,7,> <12> 3 <21> | 7, 1 2 3 |,

<56> <32> 3 <23> | <56> <32> 3 <23> | <21> <7,5,> 6, <5,6,> | <7,1> <23> 6, <35> |
<56> <32> 3 <23> | <56> <32> 3 <23> | <21> <7,5,> 6, <5,6,> | <7,1> <23> 6, <35> |
<56> <32> 3 <23> | <56> <32> 3 <23> | <21> <7,5,> 6, <5,6,> | <7,1> <23> 6, <35> |
<56> <32> 3 <23> | <56> <32> 3 <67> | <1'7> <65> 3 <23> | <21> <7,5,> 6, |,

<35> |,

0 |;

G 4/4 137
<35> |
<56> <32> 3 <23> | <56> <32> 3 <23> | <21> <7,5,> 6, <5,6,> | <7,1> <23> 6, <35> |
<56> <32> 3 <23> | <56> <32> 3 <23> | <21> <7,5,> 6, <5,6,> | <7,1> <23> 6, <35> |
<56> <32> 3 <23> | <56> <32> 3 <23> | <21> <7,5,> 6, <5,6,> | <7,1> <23> 6, <35> |
<56> <32> 3 <23> | <56> <32> 3 <67> | <1'7> <65> 3 <23> | <21> <7,5,> 6, 0 |
<6,.6,/> <-6,> <6,.6,/> <-6,> | <6,.6,/> <-6,> <6,.6,/> <-6,> |
<6,.6,/> <-6,> <6,.6,/> <-6,> | <6,.6,/> <-6,> <6,.6,/> <-0> |:

1 1 2 2 3 4 3 5 1 1 2 2 3 6
```

### 段落格式

| 符号 | 说明 |
| --- | --- |
| `F#` | 调式。`F#` 即 `1 = F#`（升 F 大调），又如，降 C 大调表示为 `Cb`。 |
| `4/4` | 节奏型。如 `4/4`, `6/8`, `1/2` ... |
| `174` | 每分钟节拍数（BPM） |
| `\|` | 小节线 |
| `\|,` | 用于表示该段乐谱结束，且下一段的调号、节奏型、速度和当前段相同。（通常用于当乐曲中存在反复记号时） |
| `\|;` | 用于表示该段乐谱结束，下一段需要重新设置调号、节奏型和速度。（用于当乐曲的调号、节奏型与速度中途改变时） |
| `\|\|` | 用于表示乐谱结束。 |
| `\|:` | 当乐谱中存在反复记号（各段的演奏顺序需要手动排列）时，用此符号表示乐谱结束。并在后面输入乐谱各段在整首乐曲中的排列顺序。 |

### 音符格式

| 符号 | 说明 |
| --- | --- |
| `1` ~ `7` | 音符 |
| `0` | 休止符 |
| `#` | 升号（紧跟在音符后） |
| `b` | 降号（同上） |
| `=` | 还原号（同上） |
| `'` | 将当前音符升高八度 |
| `,` | 将当前音符降低八度 |
| `-` | 延长线，每加一条横线相当于延长一个四分音符的长度，也可用于替代延音线第一个以后的音符（表示延续前一个音符） |
| `.` | 附点 |
| `/` | 用于表示下加线 |
| `<...>` | 表示为 `<` 和 `>` 之间的所有音符添加下加线。例如，`<<1/2/>2/>` 等同于 `1///2///2//`. |
| `[3]{...}` | 三连音，同理， `[5]{...}` 表示五连音。由四拍分拆而来的七连音可写作 `[7]{...}` 或 `[7:4]{...}`，而由六拍分拆而来或由八拍结合合而来的七连音则分别需表示为 `[7:6]{...}` 和 `[7:8]{...}`，依此类推。此外，[x]{<...>} 可略写为 `[x]<...>`。 |

更多乐谱示例见[此处](examples)。
